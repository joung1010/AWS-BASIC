### 보안 그룹(Security Group)이란?

`보안 그룹(Security Group)`이란 **AWS 클라우드에서의 네트워크 보안**을 의미한다.  

AWS 리소스(EC2 인스턴스)를 **집**이라고 생각한다면, **보안 그룹**은 **집 바깥 쪽에 쳐져있는 울타리와 대문**이라고 생각하면 된다. 집에 접근할 때 울타리의 대문에서 접근해도 되는 요청인지 보안 요원이 검사를 하는 것과 비슷하다.

EC2 인스턴스 주위에 방화벽 역할을 할 보안 그룹(Security Group)을 만들고 보안 그룹에 규칙을 지정한다. 이 보안 규칙에는 인바운드 트래픽(즉, 보안 그룹의 외부에서 내부로 보내는 트래픽)에서 어떤 트래픽만 허용할 지 설정할 수 있고, 아웃바운드 트래픽(즉, 보안 그룹의 내부에서 외부로 나가는 트래픽)에서 어떤 트래픽만 허용할 지 설정할 수 있다.

보안 그룹을 설정할 때는 허용할 **IP 범위**와 포트(port)를 설정할 수 있다.  
  
### 보안 그룹의 특징
- 하나의 보안 그룹에 여러 개의 AWS 리소스를 포함시킬 수 있다.
- 특정 서브넷에 종속되지 않고 여러 AWS 리소스를 하나의 보안 그룹으로 묶을 수 있다.
  
  

---  

지금까지 구성한 아키텍처에서 보안그룹을 설정한 AWS 리소스에는 로드밸런서, bastion-host(EC2 인스턴스), instagram-server(EC2 인스턴스), RDS 인스턴스가 있다.  
  
## ALB 로드 밸런서 보안그룹 수정

### 아키텍처 그림 살펴보기

인프라 아키텍처 그림을 보면 보안 그룹을 어떻게 셋팅해야 할 지 파악하기 쉽다. 아키텍처 그림을 통해서 ALB에 어떤 트래픽이 들어오는 지 대략적으로 파악해보자.  
  
![img_0.png](img/img_0.png)  
**용자는 ALB로 요청을 보낸다.**  
  
  
### ALB에 설정해야 할 보안 그룹 규칙
![img_1.png](img/img_1.png)  
생성한 로드 밸런서를 보면 HTTP 프로토콜(80번 포트)에 대한 요청만 받게끔 설정을 했다. 따라서 **인바운드 규칙의 포트 범위는 HTTP/80번 포트로 설정**하면 된다. 또한 로드 밸런서로는 모든 사용자로부터 요청을 받을 수 있어야 하기 때문에 **모든 IPv4에 대해 트래픽을 허용**하게끔 설정해야 한다.

일반적으로는 로드 밸런서에 HTTP 프로토콜(80번 포트) 뿐만 아니라 HTTPS 프로토콜(443번 포트)도 같이 설정해두는 편이다. 하지만 현재 HTTP 프로토콜(80번 포트)만 활용하기 때문에 이에 맞춰서 보안 그룹을 설정해보자.  
  
###  ALB의 보안 그룹 수정하기  
  
### 1.ALB의 보안 그룹 설정 페이지로 들어가기  
![img_2.png](img/img_2.png)  
  
### 2.로드 밸런서 인바운드 규칙 수정하기  
![img_3.png](img/img_3.png)  
![img_4.png](img/img_4.png)  
로드 밸런서의 리스너 규칙에서 HTTP 요청(80번 포트)의 트래픽만 받을 수 있게 설정되어 있기 때문에, 보안 그룹에서도 HTTP 요청(80번 포트)만 받을 수 있도록 수정하자.  
  
### 3. **로드밸런서 아웃바운드 규칙 체크하기**

아웃바운드 규칙은 내부에서 외부로 보내는 트래픽에 대한 규칙이다. 내부에서 요청을 보내는 것에 대한 제약이기 때문에 보안적으로 안전하다. 이 때문에 아웃바운드 규칙은 별도로 수정하지 않고 모든 트래픽에 허용하는 기본 설정을 그대로 두는 편이다.  
  
![img_5.png](img/img_5.png)
  
### 4.잘 작동하는 지 확인하기
![img_6.png](img/img_6.png)
  
### 보안 그룹 설정 완료
![img_7.png](img/img_7.png)