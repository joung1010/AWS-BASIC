# AWS EC2 네트워크 설정 요소 정리

AWS EC2를 생성할 때 **네트워크 설정** 부분에서 주로 다루게 되는 항목은 **VPC, 서브넷, 보안 그룹, 인바운드 규칙** 등입니다. 이들은 AWS 내부에서 가상 네트워크를 구성하고, 외부와의 통신 경로와 방화벽 정책을 설정하기 위해 사용됩니다.

아래 내용에서 하나씩 자세히 살펴보겠습니다.

---

## 1. VPC (Virtual Private Cloud)

**VPC**는 AWS에서 제공하는 **논리적으로 격리된 가상 네트워크 환경**입니다.

- **내부 IP 주소 범위(CIDR 블록)**, **라우팅 정책**, **서브넷 구성** 등 네트워크의 주요 요소를 직접 정의할 수 있습니다.
- 각 AWS 계정에는 기본 VPC가 존재하긴 하나, 보통 사용자 정의 VPC를 만들어 **CIDR 블록(예: 10.0.0.0/16 등)**을 설정하고 그 안에 여러 **서브넷**을 배치합니다.

**VPC의 주요 특징**

- 논리적으로 격리된 네트워크 환경을 제공하여 보안을 강화합니다.
- IP 주소 범위를 유연하게 지정 가능하며, 여러 서브넷(public, private)을 구성하여 다양한 아키텍처를 구현할 수 있습니다.
- **인터넷 게이트웨이(IGW)**, **NAT 게이트웨이**, **VPC 엔드포인트** 등을 통해 외부 네트워크와 연동하거나 외부 인터넷에 연결할 수 있습니다.

---

## 2. Subnet (서브넷)

**서브넷**은 VPC 내에서 지정한 IP 주소 범위를 더 세분화한 **서브 네트워크**입니다.

- 일반적으로 **Public Subnet**과 **Private Subnet**으로 나누어 구성합니다.
    - **Public Subnet**: 인터넷 게이트웨이(IGW)를 통해 외부(인터넷)와 직접 통신 가능한 서브넷
    - **Private Subnet**: 외부 인터넷에 직접적으로 노출되지 않고 내부 통신이나 NAT 게이트웨이를 통해서만 외부와 통신

### 서브넷 라우팅

- *라우팅 테이블(Routing Table)**을 통해 특정 서브넷이 어디로 트래픽을 보내는지(IGW, NAT, 다른 VPC 등)를 정의합니다.
- Public Subnet에는 **0.0.0.0/0 → IGW** 와 같은 규칙이 있어, 인터넷과 직접 통신하게 됩니다.
- Private Subnet은 외부 접근이 필요한 경우, **NAT 게이트웨이**를 사용하여 내부에서만 Outbound 트래픽을 보낼 수 있게 하는 것이 일반적인 패턴입니다.

---

## 3. Security Group (보안 그룹)

**Security Group**은 **인스턴스(EC2) 단위로 적용되는 가상 방화벽** 역할을 합니다.

### 주요 특징

1. **상태 저장(상태 기반, Stateful)**
    - 인바운드 규칙에 허용된 트래픽에 대한 응답(아웃바운드)은 자동으로 허용됩니다.
    - 예: 인바운드에서 80 포트를 열어두면, 그에 대한 응답이 돌아가는 아웃바운드는 별도 설정이 필요 없습니다.
2. **인바운드/아웃바운드 규칙**을 각각 정의
    - **인바운드 규칙**: 외부(또는 내부 다른 리소스)에서 들어오는 트래픽을 제한 또는 허용
    - **아웃바운드 규칙**: 인스턴스에서 나가는 트래픽을 제한 또는 허용
3. **Allow List 기반**
    - 기본적으로 모든 트래픽이 **차단**되어 있으며, 명시적으로 허용한 트래픽만 들어오고 나갈 수 있습니다.
4. **VPC 범위 내**에서 적용
    - 보안 그룹은 VPC 밖으로는 직접 적용되지 않고, VPC 내부 리소스(EC2, RDS 등)에 연결되며, 리소스 간 트래픽과 외부 트래픽을 통제합니다.

### 일반적인 설정 예시

- 웹 서버로 사용하려면 **인바운드**에 80/TCP(HTTP), 443/TCP(HTTPS) 등을 허용
- SSH로 접속하려면 22/TCP를 특정 IP(예: 내 IP)에서만 열어두기(보안상 제한)

---

## 4. Inbound Security Rules (인바운드 보안 규칙)

**인바운드 보안 규칙**은 **Security Group** 내에서 정의됩니다. “어떤 프로토콜과 포트를 어떤 소스 IP(혹은 CIDR)로부터 허용할 것인지”를 설정합니다.

예를 들어, 아래와 같은 구성을 생각해볼 수 있습니다:

| 유형 (프로토콜) | 포트 범위 | 소스(CIDR/IP) | 설명 |
| --- | --- | --- | --- |
| SSH (TCP) | 22 | 203.0.113.0/24 | 특정 IP 대역에서만 SSH 허용 |
| HTTP (TCP) | 80 | 0.0.0.0/0 | 전 세계 누구나 HTTP 접속 허용 |
| HTTPS (TCP) | 443 | 0.0.0.0/0 | 전 세계 누구나 HTTPS 접속 허용 |
| Custom TCP Rule | 8080 | 10.0.0.0/16 | 내부 VPC 대역 서브넷에서만 8080 허용 |
- `0.0.0.0/0`은 IPv4 전체 대역을 의미합니다(전 세계).
- 필요에 따라 IPv6 대역(::/0)도 설정해야 합니다.

> 보안상 22/SSH 포트는 특정 IP만 허용하거나, VPN 혹은 Bastion Host를 통해 접속하는 방식을 권장합니다.
>

---

## 5. 기타 네트워크 보안 요소: NACL (Network ACL)

**NACL**(Network Access Control List)은 **서브넷 단위**로 적용되는 **네트워크 레벨의 방화벽** 역할입니다.

- **무상태(Stateless)** 이므로 인바운드 규칙과 아웃바운드 규칙을 각각 명시해야 합니다.
- **Security Group**이 주로 인스턴스 레벨 방화벽으로 쓰이고, **NACL**은 서브넷 전체에 대한 보안 정책을 적용할 때 쓰입니다.
- 일반적으로는 Security Group 만으로 충분한 경우가 많으며, NACL은 추가적으로 세분화된 보안이 필요할 때 사용합니다.

---

## 6. 기본적인 네트워크 구성 예시

1. **VPC 생성**: CIDR 예: `10.0.0.0/16`
2. **서브넷 2개**:
    - **public-subnet** (10.0.1.0/24) → 인터넷 게이트웨이 연결
    - **private-subnet** (10.0.2.0/24) → NAT 게이트웨이 연결
3. **EC2 인스턴스**:
    - Public Subnet에 배포, **보안 그룹**에 80, 443, 22 포트(SSH) 열기
    - Private Subnet에는 DB, 백엔드 등 외부 접근 필요없는 리소스 배포
4. **Security Group** 설정:
    - 웹 서버 SG: 인바운드 80, 443, 22
    - DB 서버 SG: 인바운드 3306(MySQL) 또는 5432(PostgreSQL) 등, 소스는 웹 서버 SG만 허용
5. **NACL**(선택 사항):
    - Public Subnet에 기본 허용 NACL, Private Subnet에 기본 허용 NACL 또는 세분화 필요시 추가 설정

---

## 7. AWS EC2 네트워크 설정 시 유의사항

- **보안 그룹**만으로는 서브넷을 설정할 수 없음. **VPC + Subnet + 보안 그룹** 모두 적절히 맞춰야 EC2 인스턴스가 정상적으로 통신 가능.
- **인터넷 접속이 필요한지 여부**에 따라 Public Subnet과 Private Subnet을 구분해서 배치.
- **인바운드 트래픽**은 필요한 포트만 열어야 보안 위험이 줄어듦.
- **아웃바운드 트래픽**도 특정 주소만 허용하거나, 특정 프로토콜만 열어두면 보안을 강화할 수 있음.

---

## 🔖 최종 정리

| 항목 | 설명 |
| --- | --- |
| **VPC** | AWS가 제공하는 가상 네트워크, IP 범위·서브넷·라우팅 설정 가능 |
| **Subnet** | VPC 내 세분화된 네트워크, Public/Private로 나눠서 외부 접근 관리 |
| **Security Group** (SG) | 인스턴스 레벨 가상 방화벽, 인바운드/아웃바운드 정책 설정, 상태 기반(Stateful) |
| **Inbound Security Rules** | 보안 그룹의 인바운드 규칙, 허용할 프로토콜·포트·소스 IP(또는 SG) 지정 |
| **NACL** | 서브넷 단위의 네트워크 ACL, 무상태(Stateless), 세분화된 서브넷 보안정책 가능 |
| **인터넷 게이트웨이(IGW)** | Public Subnet이 외부 인터넷과 연결될 수 있도록 라우팅 |
| **NAT 게이트웨이** | Private Subnet 리소스가 인터넷에 Outbound로 접속할 수 있도록 중계 |

이로써 EC2 네트워크 설정에서의 주요 개념(VPC, 서브넷, 보안 그룹, 인바운드 규칙 등)을 이해할 수 있습니다.

특히 **보안 그룹의 인바운드 정책**을 어떻게 설정하느냐에 따라 **외부 접근이 제한**되거나 **허용**되므로, 운영 환경에서는 최소 권한 원칙으로 관리하는 것을 권장합니다.

> 위 내용을 바로 복사하여 노션(Notion) 등에서 활용할 수 있도록 마크다운 형식으로 구성했습니다.
>